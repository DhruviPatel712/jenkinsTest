// // pipeline {
// //     agent any
// //     tools {
// //         maven 'maven'
// //     }
// //
// //     stages {
// //
// //         stage('Build') {
// //             steps {
// //
// //                  bat 'mvn clean package'
// //
// //             }
// //         }
// //
// //         stage('Deploy to Tomcat') {
// //             steps {
// //                 script {
// //                   // deploy adapters: [tomcat9(credentialsId: '30bc9812-7857-470b-be20-2cba0331c22f', path: 'jenkinsTest', url: 'http://192.168.100.55:8080/')], contextPath: 'C:/Program Files/Apache Software Foundation/Tomcat 10.1', war: '**/*.war'
// //                   //deploy contextPath: 'C:\\Program Files\\Apache Software Foundation\\Tomcat 10.1', war: '**/*.war'
// //                   // deploy adapters: [tomcat9(credentialsId: 'dhruvi', path: '', url: 'http://192.168.100.55:8080/')], contextPath: null, onFailure: false, war: '**/*.war'
// //
// //                   //deploy adapters: [tomcat9(credentialsId: 'dhruvi', path: '', url: 'http://192.168.100.55:8080/')], contextPath: 'C:/Program Files/Apache Software Foundation/Tomcat 10.1/webapps', onFailure: false, war: '**/*.war'
// //
// //                   //deploy adapters: [tomcat9(credentialsId: '6dda90c2-49aa-4881-8946-98983d1f63dc', path: '', url: 'http://192.168.100.55:8080/')], contextPath: 'C:/Program Files/Apache Software Foundation/Tomcat 10.1/webapps/', war: '**/*.war'
// // //                   deploy adapters: [tomcat9(credentialsId: '86bd85f9-f1ca-4132-b414-d8bdf7334183', path: 'jenkinsTest', url: 'https://baeb-27-109-25-22.ngrok.io/')], contextPath: 'C:/Program Files/Apache Software Foundation/Tomcat 10.1', war: '**/*.war'
// // //
// //
// //                   deploy adapters: [tomcat9(credentialsId: '17b664e0-d5dd-48a4-9cc4-f880466df5e4', path: '', url: 'http://localhost:8080/')], contextPath: 'C:/Program Files/Apache Software Foundation/Tomcat 10.1/webapps/', war: '**/*.war'
// //
// //                 }
// //             }
// //         }
// //     }
// // }
//
//
//
// pipeline {
//     agent any
// tools {
//          maven 'maven'
//      }
//     environment {
//         TOMCAT_URL = 'https://98c6-103-240-79-198.ngrok-free.app/'  // URL of your Tomcat server
//         TOMCAT_USER = 'admin'  // Tomcat Manager username
//         TOMCAT_PASSWORD = 'Test@123'  // Tomcat Manager password
//         WAR_FILE_PATH = 'E:/jenkinsTest/jenkinsTest/target/'  // Path to your WAR file
//         CONTEXT_PATH = 'JenkinsTest'  // The context path where you want to deploy your app
//     }
//
//     stages {
//                  stage('Build') {
//                        steps {
//
//                             bat 'mvn clean package'
//
//                        }
//                    }
//
//         stage('Deploy to Tomcat') {
//             steps {
//                 script {
//                     // Use curl or PowerShell (Invoke-WebRequest) to deploy the WAR file to Tomcat Manager
//                     def deployCommand = """
//                         curl -u ${TOMCAT_USER}:${TOMCAT_PASSWORD} ${TOMCAT_URL}/manager/text/deploy?path=${CONTEXT_PATH} -T "${WAR_FILE_PATH}"
//                     """
//
//                     // Execute the deploy command
//                     bat(deployCommand)
//                 }
//             }
//         }
//     }
//
// }

pipeline {
    agent any

 stages {


    stage('Build WAR') {
                steps {
                    script {
                        def mvnHome = tool name: 'maven', type: 'maven'
                        def compilePackageCommand = "${mvnHome}\\bin\\mvn.cmd package"

                        bat(script: compilePackageCommand)
                    }
                }
         }

        stage('Copy WAR to Linux Server') {
            steps {
                script {
                    def remoteServer = [
                        host: '20.204.136.143',
                        user: 'root'
                    ]

                    def warFileName = 'JenkinsTest.war'
                    def localWarPath = 'C:\\path\\to\\local\\JenkinsTest.war' // Replace with the actual path to your WAR file on Windows
                    def remoteWarPath = '/opt/tomcat/webapps' // Replace with the desired path on the Linux server

                    // Compile and package using Maven
                    def mvnHome = tool name: 'maven', type: 'maven'
                    def compilePackageCommand = "${mvnHome}\\bin\\mvn.cmd package"



                    def sshCommand = """
                        scp -o StrictHostKeyChecking=no "${localWarPath}" "${remoteServer.user}@${remoteServer.host}:${remoteWarPath}"
                    """

                    def sshExitCode = bat(script: sshCommand, returnStatus: true)

                    if (sshExitCode == 0) {
                        echo 'WAR file copied successfully to the Linux server.'
                    } else {
                        error "Error copying WAR file to Linux server. Exit code: ${sshExitCode}"
                    }
                }
            }
        }
    }
}













